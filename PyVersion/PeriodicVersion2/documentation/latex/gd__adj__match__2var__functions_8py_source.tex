\hypertarget{gd__adj__match__2var__functions_8py_source}{}\doxysection{gd\+\_\+adj\+\_\+match\+\_\+2var\+\_\+functions.\+py}
\label{gd__adj__match__2var__functions_8py_source}\index{C:/Users/levon/Downloads/FTR\_Adjoint/PyVersion/PeriodicVersion/gd\_adj\_match\_2var\_functions.py@{C:/Users/levon/Downloads/FTR\_Adjoint/PyVersion/PeriodicVersion/gd\_adj\_match\_2var\_functions.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00001}00001 \textcolor{keyword}{from} moment\_equations\_util \textcolor{keyword}{import} *}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00002}00002 \textcolor{keyword}{from} moment\_equations \textcolor{keyword}{import} *}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00004}00004 \textcolor{comment}{\# constants across functions}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00005}00005 k0 = 10}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00006}00006 h = 0.0001 \textcolor{comment}{\# ode step size, make sure h << magnet thicknesses}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00008}00008 \textcolor{comment}{\#physics settings}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00009}00009 physics\_params = \{\textcolor{stringliteral}{'energy'}: 10e3, \textcolor{comment}{\#eV}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00010}00010                     \textcolor{stringliteral}{'current'}: 1.0e-\/4, \textcolor{comment}{\#Amps}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00011}00011                     \textcolor{stringliteral}{'pipe\_radius'}: 0.0 \textcolor{comment}{\#meters}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00012}00012                     \}    }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00014}00014 \textcolor{keyword}{def }getLattice(an,periodicity=1):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00015}00015     qstr = 0.02661}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00016}00016     ql = 0.05425}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00018}00018     qstr1,qstr2,qstr3 = an[0],an[1],an[2]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00019}00019     qlen1,qlen2,qlen3 = ql/2.0,ql,ql/2.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00020}00020     dlen1,dlen2,dlen3 = 0.0,0.025,0.025}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00021}00021     repeat = periodicity \textcolor{comment}{\# periodicity}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00023}00023     amplitude = [qstr1,qstr2,qstr3] \textcolor{comment}{\# quadrupole amplitude}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00024}00024     qlength = [qlen1,qlen2,qlen3] \textcolor{comment}{\# quadrupole length}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00025}00025     dlength = [dlen1,dlen2,dlen3] \textcolor{comment}{\# drift space length}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00026}00026     polarity = [1,-\/1,1] \textcolor{comment}{\# quadrupole polarity}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00028}00028     lattice = CreateLatticeProfile(amplitude,qlength,dlength,polarity,repeat,verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00029}00029     \textcolor{comment}{\# reverse lattice for adj}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00030}00030     lattice\_r = np.copy(lattice)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00031}00031     lattice\_r[:,[0,1]] = lattice\_r[:,[1,0]]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00032}00032     lattice\_r = np.flip(lattice\_r,0)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00033}00033     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00034}00034     \textcolor{keywordflow}{return} lattice,lattice\_r}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00036}00036 \textcolor{keyword}{def }Initial\_conditions():}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00037}00037     Q\_plus = 0.5*(2.2581**2*1e-\/6 + 0.2258**2*1e-\/6)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00038}00038     Q\_minus = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00039}00039     Q\_x = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00040}00040     P\_plus = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00041}00041     P\_minus = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00042}00042     P\_x = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00043}00043     E\_plus = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00044}00044     E\_minus = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00045}00045     E\_x = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00046}00046     L = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00047}00047     phi = 0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00048}00048    }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00049}00049     \textcolor{keywordflow}{return} np.array([Q\_plus,Q\_minus,Q\_x,P\_plus,P\_minus,P\_x,E\_plus,E\_minus,E\_x,L,phi])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00051}00051 \textcolor{comment}{\# Pick a FoM and define functions}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00052}00052 \textcolor{keyword}{def }get\_FOMp(y):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00053}00053     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00054}00054     \textcolor{comment}{\# figure of merit broken into pieces for ease of reading    }}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00055}00055     FoM1 = 0.5*np.sum( (y[0:3,-\/1]-\/y[0:3,0])**2 )*k0**2.}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00056}00056     FoM2 = 0.5*np.sum( (y[3:6,-\/1]-\/y[3:6,0])**2 )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00057}00057     FoM3 = 0.5*np.sum( (y[6:9,-\/1]-\/y[6:9,0])**2 )*k0**(-\/2.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00058}00058     FoM4 = 0.5*np.sum( (y[9,-\/1]-\/y[9,0])**2 )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00059}00059         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00060}00060     FoM = FoM1 + FoM2 + FoM3 + FoM4}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00061}00061     FoMp = np.array([FoM1,FoM2,FoM3,FoM4])  }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00062}00062           }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00063}00063     \textcolor{keywordflow}{return} FoM,FoMp        }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00065}00065 \textcolor{keyword}{def }get\_FOMe(y):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00066}00066     FoM = y[0,0]**2}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00068}00068     \textcolor{keywordflow}{return} FoM}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00069}00069         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00070}00070 \textcolor{keyword}{def }get\_dFOMp(y):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00071}00071     \textcolor{comment}{\# derivative of FoM with respect to Q,P,E,L}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00072}00072     \textcolor{comment}{\# dF/dQ}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00073}00073     dQ\_p = ( y[0,-\/1]-\/y[0,0] )*k0**2.}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00074}00074     dQ\_m = ( y[1,-\/1]-\/y[1,0] )*k0**2.}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00075}00075     dQ\_x = ( y[2,-\/1]-\/y[2,0] )*k0**2.}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00076}00076     \textcolor{comment}{\# dF/dP}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00077}00077     dP\_p = ( y[3,-\/1]-\/y[3,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00078}00078     dP\_m = ( y[4,-\/1]-\/y[4,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00079}00079     dP\_x = ( y[5,-\/1]-\/y[5,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00080}00080     \textcolor{comment}{\# dF/dE}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00081}00081     dE\_p = ( y[6,-\/1]-\/y[6,0] )*k0**(-\/2.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00082}00082     dE\_m = ( y[7,-\/1]-\/y[7,0] )*k0**(-\/2.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00083}00083     dE\_x = ( y[8,-\/1]-\/y[8,0] )*k0**(-\/2.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00084}00084     \textcolor{comment}{\# dF/dL}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00085}00085     dL = np.abs( y[9,-\/1]-\/y[9,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00086}00086     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00087}00087     \textcolor{keywordflow}{return} np.array([dQ\_p,dQ\_m,dQ\_x,dP\_p,dP\_m,dP\_x,dE\_p,dE\_m,dE\_x,dL])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00089}00089 \textcolor{keyword}{def }get\_dFOMe(y):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00090}00090     \textcolor{comment}{\# dF/dQ}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00091}00091     dQdot\_p = -\/2*y[0,0]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00092}00092     dQdot\_m = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00093}00093     dQdot\_x = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00094}00094     \textcolor{comment}{\# dF/dP}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00095}00095     dP\_p = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00096}00096     dP\_m = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00097}00097     dP\_x = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00098}00098     \textcolor{comment}{\# dF/dE}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00099}00099     dE\_p = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00100}00100     dE\_m = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00101}00101     dE\_x = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00102}00102     \textcolor{comment}{\# dF/dL}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00103}00103     dL = 0.0  }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00104}00104 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00105}00105     \textcolor{keywordflow}{return} np.array([dQdot\_p,dQdot\_m,dQdot\_x,dP\_p,dP\_m,dP\_x,dE\_p,dE\_m,dE\_x,dL])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00107}00107 \textcolor{keyword}{def }get\_dFOMp\_X(y\_adj):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00108}00108     \textcolor{comment}{\# gradient of FOM\_p with respect to X}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00109}00109     \textcolor{comment}{\# dF/dX for dQ}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00110}00110     dQ\_p = -\/( y\_adj[6,0]-\/y\_adj[6,-\/1] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00111}00111     dQ\_m = -\/( y\_adj[7,0]-\/y\_adj[7,-\/1] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00112}00112     dQ\_x = -\/( y\_adj[8,0]-\/y\_adj[8,-\/1] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00113}00113     \textcolor{comment}{\# dF/dX for dP}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00114}00114     dP\_p = ( y\_adj[3,0]-\/y\_adj[3,-\/1] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00115}00115     dP\_m = ( y\_adj[4,0]-\/y\_adj[4,-\/1] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00116}00116     dP\_x = ( y\_adj[5,0]-\/y\_adj[5,-\/1] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00117}00117     \textcolor{comment}{\# dF/dX for dE}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00118}00118     dE\_p = -\/( y\_adj[0,0]-\/y\_adj[0,-\/1] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00119}00119     dE\_m = -\/( y\_adj[1,0]-\/y\_adj[1,-\/1] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00120}00120     dE\_x = -\/( y\_adj[2,0]-\/y\_adj[2,-\/1] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00121}00121     \textcolor{comment}{\# dF/dX for dL}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00122}00122     dL = -\/( y\_adj[9,0]-\/y\_adj[9,-\/1] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00123}00123     dphi = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00124}00124     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00125}00125     \textcolor{keywordflow}{return} np.array([dQ\_p,dQ\_m,dQ\_x,dP\_p,dP\_m,dP\_x,dE\_p,dE\_m,dE\_x,dL,dphi])  }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00127}00127 \textcolor{keyword}{def }get\_dFOMe\_X(y\_adj):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00128}00128     \textcolor{comment}{\# gradient of FOM\_p with respect to X}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00129}00129     \textcolor{comment}{\# dF/dX for dQ}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00130}00130     dQ\_p = ( y\_adj[6,0] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00131}00131     dQ\_m = ( y\_adj[7,0] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00132}00132     dQ\_x = ( y\_adj[8,0] )*k0**(-\/1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00133}00133     \textcolor{comment}{\# dF/dX for dP}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00134}00134     dP\_p = -\/( y\_adj[3,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00135}00135     dP\_m = -\/( y\_adj[4,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00136}00136     dP\_x = -\/( y\_adj[5,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00137}00137     \textcolor{comment}{\# dF/dX for dE}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00138}00138     dE\_p = ( y\_adj[0,0] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00139}00139     dE\_m = ( y\_adj[1,0] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00140}00140     dE\_x = ( y\_adj[2,0] )*k0**(1.)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00141}00141     \textcolor{comment}{\# dF/dX for dL}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00142}00142     dL = ( y\_adj[9,0] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00143}00143     dphi = 0.0}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00144}00144     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00145}00145     \textcolor{keywordflow}{return} np.array([dQ\_p,dQ\_m,dQ\_x,dP\_p,dP\_m,dP\_x,dE\_p,dE\_m,dE\_x,dL,dphi])     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00146}00146     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00147}00147 \textcolor{keyword}{def }get\_dFOMp\_a(z,Y,Y\_adj,O\_per,N\_per,ACT\_per):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00148}00148     \textcolor{comment}{\# gradient of FOM\_p with respect to "{}a"{} parameter}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00149}00149     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00150}00150     \textcolor{comment}{\# two integrals to calculate with 4 pieces in each integral}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00151}00151     int1\_1 = np.zeros(len(z))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00152}00152     int1\_2 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00153}00153     int1\_3 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00154}00154     int1\_4 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00155}00155     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00156}00156     int2\_1 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00157}00157     int2\_2 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00158}00158     int2\_3 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00159}00159     int2\_4 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00160}00160     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00161}00161     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(z)):       }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00162}00162         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00163}00163         \textcolor{comment}{\# calculate integral 1}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00164}00164         int1\_1[i] = np.dot( ACT\_per[3:6,i], Y[3:6,i] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00165}00165         int1\_2[i] = -\/ACT\_per[12,i]*Y[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00166}00166         int1\_3[i] = -\/np.dot( ACT\_per[9:12,i], Y[0:3,i] ) }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00167}00167         int1\_4[i] = -\/np.dot( ACT\_per[0:3,i], Y[6:9,i] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00168}00168         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00169}00169         \textcolor{comment}{\# calculate integral 2}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00170}00170         int2\_1[i] = np.dot( Y\_adj[3:6,i], np.matmul( O\_per[i],Y[0:3,i] ) )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00171}00171         int2\_2[i] = np.dot( Y[0:3,i], N\_per[i] )*Y\_adj[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00172}00172         int2\_3[i] = -\/np.dot( Y\_adj[0:3,i], np.matmul( O\_per[i],Y[3:6,i] ) )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00173}00173         int2\_4[i] = -\/np.dot( Y\_adj[0:3,i], N\_per[i] )*Y[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00174}00174     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00175}00175     \textcolor{comment}{\#int\_val = np.trapz(int1\_1+int1\_2+int1\_3+int1\_4,z) + np.trapz(int2\_1+int2\_2+int2\_3+int2\_4,z)}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00176}00176     int\_val = np.trapz(int2\_1+int2\_2+int2\_3+int2\_4,z)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00177}00177     \textcolor{keywordflow}{return} int\_val      }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00179}00179 \textcolor{keyword}{def }get\_dFOMe\_a(z,Y,Y\_adj,O\_per,N\_per,ACT\_per):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00180}00180     \textcolor{comment}{\# gradient of FOM\_p with respect to "{}a"{} parameter}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00181}00181     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00182}00182     \textcolor{comment}{\# two integrals to calculate with 4 pieces in each integral}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00183}00183     int1\_1 = np.zeros(len(z))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00184}00184     int1\_2 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00185}00185     int1\_3 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00186}00186     int1\_4 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00187}00187     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00188}00188     int2\_1 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00189}00189     int2\_2 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00190}00190     int2\_3 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00191}00191     int2\_4 = np.copy(int1\_1)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00192}00192     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00193}00193     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(z)):       }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00194}00194         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00195}00195         \textcolor{comment}{\# calculate integral 1}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00196}00196         int1\_1[i] = np.dot( ACT\_per[3:6,i], Y[3:6,i] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00197}00197         int1\_2[i] = -\/ACT\_per[12,i]*Y[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00198}00198         int1\_3[i] = -\/np.dot( ACT\_per[9:12,i], Y[0:3,i] ) }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00199}00199         int1\_4[i] = -\/np.dot( ACT\_per[0:3,i], Y[6:9,i] )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00200}00200         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00201}00201         \textcolor{comment}{\# calculate integral 2}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00202}00202         int2\_1[i] = np.dot( Y\_adj[3:6,i], np.matmul( O\_per[i],Y[0:3,i] ) )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00203}00203         int2\_2[i] = np.dot( Y[0:3,i], N\_per[i] )*Y\_adj[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00204}00204         int2\_3[i] = -\/np.dot( Y\_adj[0:3,i], np.matmul( O\_per[i],Y[3:6,i] ) )}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00205}00205         int2\_4[i] = -\/np.dot( Y\_adj[0:3,i], N\_per[i] )*Y[9,i]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00206}00206     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00207}00207     \textcolor{comment}{\#int\_val = np.trapz(int1\_1+int1\_2+int1\_3+int1\_4,z) + np.trapz(int2\_1+int2\_2+int2\_3+int2\_4,z)}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00208}00208     int\_val = np.trapz(int2\_1+int2\_2+int2\_3+int2\_4,z)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00209}00209     \textcolor{keywordflow}{return} -\/int\_val        }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00210}00210     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00211}00211 \textcolor{keyword}{def }gd\_FOMp(a,X):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00212}00212     \textcolor{comment}{\# grab parameters}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00213}00213     init\_cond = X}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00214}00214     lattice,\_ = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00215}00215     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00216}00216     \textcolor{comment}{\# run moment equations}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00217}00217     z,y,motion,k = run\_moments(init\_cond, lattice, h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00218}00218     \textcolor{keywordflow}{return} get\_FOMp(y)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00219}00219 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00220}00220 \textcolor{keyword}{def }gd\_FOMe(a,X):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00221}00221     \textcolor{comment}{\# grab parameters}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00222}00222     init\_cond = X}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00223}00223     lattice,\_ = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00224}00224 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00225}00225     \textcolor{comment}{\# run moment equations}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00226}00226     z,y,motion,k = run\_moments(init\_cond, lattice, h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00227}00227     \textcolor{keywordflow}{return} get\_FOMe(y)    }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00228}00228     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00229}00229 \textcolor{keyword}{def }gd\_dFOMp(a,X,z,y,y\_adj,O\_nope,N\_nope,ACT\_nope):    }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00230}00230     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00231}00231     dFOM\_X = get\_dFOMp\_X(y\_adj)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00232}00232     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00233}00233     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00235}00235     dFOM\_a = np.zeros(len(a))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00236}00236     a\_copy =  a.copy()}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00237}00237     perturb = 0.001}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00238}00238     \textcolor{keyword}{import} time}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00239}00239     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(a\_copy)):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00240}00240         \textcolor{comment}{\# perturb}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00241}00241         a[i] = a\_copy[i] + a\_copy[i]*perturb}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00242}00242         \textcolor{comment}{\# grab updated lattice}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00243}00243         lattice,\_ = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00244}00244         k = getLatticeKvsZ(lattice,h)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00245}00245         \textcolor{comment}{\# calculate O,N perturbed matrices }}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00246}00246         O,N,ACT = get\_ON\_and\_ACT(z,y,y\_adj,k,physics\_params)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00247}00247         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(len(z)):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00248}00248             O[j] = O[j] -\/ O\_nope[j]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00249}00249             N[j] = N[j] -\/ N\_nope[j]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00250}00250             }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00251}00251         \textcolor{comment}{\# calculate integral}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00252}00252         dFOM\_a[i] = get\_dFOMp\_a(z,y,y\_adj,O,N,ACT)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00253}00253         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00254}00254     \textcolor{keywordflow}{return} dFOM\_a,dFOM\_X  }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00256}00256 \textcolor{keyword}{def }gd\_dFOMe(a,X,z,y,y\_adj,O\_nope,N\_nope,ACT\_nope):    }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00257}00257     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00258}00258     dFOM\_X = get\_dFOMe\_X(y\_adj)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00259}00259     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00260}00260     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00262}00262     dFOM\_a = np.zeros(len(a))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00263}00263     a\_copy =  a.copy()}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00264}00264     perturb = 0.001}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00265}00265     \textcolor{keyword}{import} time}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00266}00266     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(a\_copy)):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00267}00267         \textcolor{comment}{\# perturb}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00268}00268         a[i] = a\_copy[i] + a\_copy[i]*perturb}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00269}00269         \textcolor{comment}{\# grab updated lattice}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00270}00270         lattice,\_ = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00271}00271         k = getLatticeKvsZ(lattice,h)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00272}00272         \textcolor{comment}{\# calculate O,N perturbed matrices }}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00273}00273         O,N,ACT = get\_ON\_and\_ACT(z,y,y\_adj,k,physics\_params)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00274}00274         ACT[9:12,0] = np.array([2*y[0,0],0,0])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00275}00275         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(len(z)):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00276}00276             O[j] = O[j] -\/ O\_nope[j]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00277}00277             N[j] = N[j] -\/ N\_nope[j]}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00278}00278             }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00279}00279         \textcolor{comment}{\# calculate integral}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00280}00280         dFOM\_a[i] = get\_dFOMe\_a(z,y,y\_adj,O,N,ACT)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00281}00281         }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00282}00282     \textcolor{keywordflow}{return} dFOM\_a,dFOM\_X           }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00284}00284 \textcolor{keyword}{def }gd\_adj\_p(a,X):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00285}00285     \textcolor{comment}{\# grab parameters}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00286}00286     init\_cond = X}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00287}00287     lattice,lattice\_r = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00288}00288     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00289}00289     \textcolor{comment}{\# run moment equations to get values at z=z\_final}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00290}00290     z,y\_m,motion,\_ = run\_moments(init\_cond, lattice, h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00291}00291     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00292}00292     \textcolor{comment}{\# setup adjoint initial conditions @ z=z\_final}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00293}00293     dF = get\_dFOMp(y\_m)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00294}00294     init\_cond\_adj = np.array([ -\/dF[6],-\/dF[7],-\/dF[8],dF[3],dF[4],dF[5],-\/dF[0],-\/dF[1],-\/dF[2],-\/dF[9],0 ])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00295}00295     init\_cond\_adj = np.concatenate(( init\_cond\_adj,np.reshape(y\_m[:,-\/1].T,(11)) ))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00296}00296     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00297}00297     \textcolor{comment}{\# Run adjoint equations backwards starting from z=z\_final to z=0}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00298}00298     z,y\_mom,y\_adj,motion,k = run\_moments\_adjoint(init\_cond\_adj, lattice\_r, -\/h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00299}00299     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00300}00300     \textcolor{keywordflow}{return} z,y\_mom,y\_adj,motion,k}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00302}00302 \textcolor{keyword}{def }gd\_adj\_e(a,X):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00303}00303     \textcolor{comment}{\# grab parameters}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00304}00304     init\_cond = X}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00305}00305     lattice,lattice\_r = getLattice(a)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00306}00306     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00307}00307     \textcolor{comment}{\# run moment equations to get values at z=z\_final}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00308}00308     z,y\_m,motion,\_ = run\_moments(init\_cond, lattice, h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00309}00309     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00310}00310     \textcolor{comment}{\# setup adjoint initial conditions @ z=z\_final}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00311}00311     dF = get\_dFOMe(y\_m)}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00312}00312     init\_cond\_adj = np.array([ 0,0,0,0,0,0,0,0,0,0,0 ])}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00313}00313     init\_cond\_adj = np.concatenate(( init\_cond\_adj,np.reshape(y\_m[:,-\/1].T,(11)) ))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00314}00314     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00315}00315     \textcolor{comment}{\# Run adjoint equations backwards starting from z=z\_final to z=0}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00316}00316     z,y\_mom,y\_adj,motion,k = run\_moments\_adjoint(init\_cond\_adj, lattice\_r, -\/h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00317}00317     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00318}00318     \textcolor{keywordflow}{return} z,y\_mom,y\_adj,motion,k}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00319}00319 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00320}00320 \textcolor{keyword}{def }PrintFoM(FoM,ss=''):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00321}00321     print(\textcolor{stringliteral}{'FoM\_'}+ss+\textcolor{stringliteral}{': '}+str(FoM))}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00322}00322 }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00323}00323 \textcolor{keyword}{def }RunMoments(lattice,init\_cond):}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00324}00324     }
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00325}00325     \textcolor{comment}{\# run moment equations}}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00326}00326     z,y,motion,k = run\_moments(init\_cond, lattice, h, physics\_params, verbose=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gd__adj__match__2var__functions_8py_source_l00327}00327     \textcolor{keywordflow}{return} z,y,motion,k}

\end{DoxyCode}
